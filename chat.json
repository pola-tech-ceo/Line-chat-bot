var ss = SpreadsheetApp.openByUrl("https://docs.google.com/spreadsheets/d/1qxhroa0MfeMbF5bCByM53cY4lkji5ZPzAW8BmJL6jzU/edit?gid=1921091551#gid=1921091551");
var sheet = ss.getSheetByName("stock");
function doPost(e) {
  var data = JSON.parse(e.postData.contents);
  var userMsg = data.originalDetectIntentRequest.payload.data.message.text;
  var values = sheet.getRange(2,
    1, sheet.getLastRow()-1, sheet.getLastColumn()).getValues();
  for (var i = 0; i < values.length; i++) {
    if (values[i
        ][
            0
        ] == userMsg) {
      var Row = i + 2;
      var Data = sheet.getRange(Row,
            2).getValue();
      var Pic= sheet.getRange(Row,
            6).getValue();
      var Place = sheet.getRange(Row,
            3).getDisplayValue();
      var Time = sheet.getRange(Row,
            4).getDisplayValue();
      var Rate = sheet.getRange(Row,
            5).getDisplayValue();
      var result = {
                "fulfillmentMessages": [
                    {
                        "platform": "line",
                        "type": 4,
                        "payload": {
                            "line": {
                                "type": "flex",
                                "altText": "Flex message",
                                "contents": {
                                    "type": "bubble",
                                    "hero": {
                                        "type": "image",
                                        "url": Pic,
                                        "size": "full",
                                        "aspectRatio": "20:13",
                                        "aspectMode": "cover",
                                        "action": {
                                            "type": "uri",
                                            "label": "Line",
                                            "uri": "https://linecorp.com/"
                                        }
                                    },
                                    "body": {
                                        "type": "box",
                                        "layout": "vertical",
                                        "contents": [
                                            {
                                                "type": "text",
                                                "text": Data,
                                                "weight": "bold",
                                                "size": "xl",
                                            },
                                            {
                                                "type": "box",
                                                "layout": "baseline",
                                                "margin": "md",
                                                "contents": [
                                                    {
                                                        "type": "icon",
                                                        "url": "https://scdn.line-apps.com/n/channel_devcenter/img/fx/review_gold_star_28.png",
                                                        "size": "sm"
                                                    },
                                                    {
                                                        "type": "icon",
                                                        "url": "https://scdn.line-apps.com/n/channel_devcenter/img/fx/review_gold_star_28.png",
                                                        "size": "sm"
                                                    },
                                                    {
                                                        "type": "icon",
                                                        "url": "https://scdn.line-apps.com/n/channel_devcenter/img/fx/review_gold_star_28.png",
                                                        "size": "sm"
                                                    },
                                                    {
                                                        "type": "icon",
                                                        "url": "https://scdn.line-apps.com/n/channel_devcenter/img/fx/review_gold_star_28.png",
                                                        "size": "sm"
                                                    },
                                                    {
                                                        "type": "icon",
                                                        "url": "https://scdn.line-apps.com/n/channel_devcenter/img/fx/review_gray_star_28.png",
                                                        "size": "sm"
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": "4.0",
                                                        "size": "sm",
                                                        "color": "#999999",
                                                        "margin": "md",
                                                    }
                                                ]
                                            },
                                            {
                                                "type": "box",
                                                "layout": "vertical",
                                                "spacing": "sm",
                                                "margin": "lg",
                                                "contents": [
                                                    {
                                                        "type": "box",
                                                        "layout": "baseline",
                                                        "spacing": "sm",
                                                        "contents": [
                                                            {
                                                                "type": "text",
                                                                "text": "ปลีก："+Place,
                                                                "size": "sm",
                                                            },
                                                            {
                                                                "type": "text",
                                                                "text": "ส่ง:"+Time,
                                                                "size": "sm",
                                                                "wrap": true,
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "type": "box",
                                                        "layout": "baseline",
                                                        "spacing": "sm",
                                                        "contents": [
                                                            {
                                                                "type": "text",
                                                                "text": "เหลือ:"+Rate,
                                                                "size": "sm",
                                                            },
                                                            {
                                                                "type": "text",
                                                                "text": " ",
                                                                "size": "sm",
                                                                "color": "#666666",
                                                                "wrap": true,
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    "footer": {
                                        "type": "box",
                                        "layout": "vertical",
                                        "spacing": "sm",
                                        "contents": [
                                            {
                                                "type": "button",
                                                "action": {
                                                    "type": "uri",
                                                    "label": "CALL",
                                                    "uri": "https://linecorp.com"
                                                },
                                                "height": "sm",
                                                "style": "link"
                                            },
                                            {
                                                "type": "button",
                                                "action": {
                                                    "type": "uri",
                                                    "label": "WEBSITE",
                                                    "uri": "https://linecorp.com"
                                                },
                                                "height": "sm",
                                                "style": "link"
                                            },
                                            {
                                                "type": "spacer",
                                                "size": "sm"
                                            }
                                        ]
                                    }
                                }
                            }
                        }
                    }
                ]
            }
      var replyJSON = ContentService.createTextOutput(JSON.stringify(result)).setMimeType(ContentService.MimeType.JSON);
      return replyJSON;
        }
    }
}